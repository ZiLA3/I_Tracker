# I_Tracker
Game With Eye Tracking

### Flow Chart

![I_Tracker_flowchart](https://github.com/ZiLA3/I_Tracker/blob/main/I_Tracker_flowchart.png)


## 파이썬 모듈

---

### 1. Network.py

- 시스템의 **네트워크 통신**을 담당합니다.
- **상태(state)** 에 따라 필요한 메소드를 포함하고 있습니다.
- **UDP 소켓**을 사용하여 데이터를 송수신하며, 모든 데이터는 **UTF-8로 인코딩**되어 전송됩니다.
- 수신 시 **비동기 방식**을 사용하지만, 콜백 함수가 아닌 `UDPstate` 클래스의 메소드를 통해 수신된 값을 처리합니다.
- **캘리브레이션 포인트 기능은 더 이상 사용하지 않으며**, 눈 위치의 절댓값을 그대로 매핑하여 사용합니다.

---

### 2. Tracker.py

- **MediaPipe** 프레임워크를 이용하여 **손과 눈의 위치**를 추적합니다.
- **눈의 위치**는 화면상의 **커서 위치**로 매핑되어 사용됩니다.
- **손의 제스처**를 인식하여 게임 내 다양한 액션을 실행합니다.
- 추적된 **눈 위치와 손 위치 데이터를 유니티 프로세스에 전달**합니다.

#### ▷ MediaPipe의 추적 원리

MediaPipe는 구글에서 개발한 실시간 영상 인식 프레임워크로, 신체 부위의 위치를 정확하게 추적합니다.  
MediaPipe의 파이프라인은 크게 두 단계로 이루어집니다.

1. **탐지기(Detector)**: 전체 이미지에서 ROI(관심영역)를 찾습니다.
    
2. **추적기(Tracker)**: ROI 내에서 3D 랜드마크(예: 손의 경우 21개, 얼굴의 경우 468개 등)를 예측합니다.
    

첫 프레임에서는 탐지기가 동작하고, 이후에는 추적기가 이전 프레임 결과를 바탕으로 연속적으로 랜드마크를 추정합니다.  
만약 추적 신뢰도가 낮아지거나 객체가 사라지면 다시 탐지기가 동작합니다.  
이 방식은 연산 효율성을 높이고, 실시간 성능을 보장합니다.  
MediaPipe Hands의 경우, BlazePalm이라는 손바닥 검출 모델로 손의 위치를 찾고, 이후 고해상도 랜드마크 모델을 통해 21개의 손 관절 위치를 3D로 예측합니다.

---

### 3. xyMapper.py

- **눈의 위치 좌표를 화면 좌표로 변환**하는 역할을 합니다.
    
- 기존에는 **호모그래피(Homography) 변환**을 사용하여, 눈 위치 좌표와 각 화면 모서리를 바라봤을 때의 좌표(4개)를 화면 좌표에 매핑하는 방식이었습니다.
    
- **호모그래피 변환 원리**  
    호모그래피는 한 평면의 점들을 다른 평면의 점들로 매핑하는 기하학적 변환입니다.  
    이 변환은 3×3 행렬로 표현되며, 동차 좌표(homogeneous coordinates) 체계에서 작동합니다.  
    예를 들어, 카메라로 촬영한 두 장의 이미지에서 네 쌍 이상의 대응점을 찾으면, 이 점들로부터 호모그래피 행렬 H를 계산할 수 있습니다.  
    OpenCV의 `findHomography` 함수와 RANSAC 알고리즘을 이용해 신뢰도 높은 변환 행렬을 얻을 수 있습니다.
    
- **현재는 카메라 해상도 및 홍채 좌표 척도 문제**로 인해, **눈의 위치를 그대로 화면 좌표에 매핑**하는 방식으로 변경되었습니다. (노트북 웹캠이나 휴대폰의 전면 카메라의 해상도는 전문 아이트래킹 장비에 비해 작아서 정확한 추적이 불가능 했습니다. 불가피하게 해당 방식으로 전환하였습니다.)
    
- 사용자는 **머리를 직접 움직여 커서를 이동**시킵니다.
    

---

### 4. Main.py

- **파이썬 메인 프로그램**으로, 전체 시스템의 실행을 담당합니다.
    
- 각 **state**에 맞춰 적절한 메소드를 실행합니다.
    
- Tracker.py에서 추적한 눈/손 위치 정보를 xyMapper.py를 통해 화면 좌표로 변환하고,  
    Network.py를 통해 유니티 프로세스에 **UDP 방식으로 실시간 전송**합니다.